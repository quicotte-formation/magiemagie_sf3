{% extends "::base.html.twig" %}

{% block title %}Partie en cours{% endblock %}

{% block body %}
    {% raw %}
        <div class="container" ng-app="monApp" ng-controller="monControleur">
            <div class="row" id="zone-joueurs">
                <div class="col-sm-12">
                    <h2>Les joueurs</h2>
                    <table class="table">
                        <tr>
                            <td style="text-align: center;" ng-repeat="j in dtoPartie.joueurs">
                                <img ng-style="{{ classeJoueur(j.ordre) }}" class="img-thumbnail" src="{{ pathImages}}/sorciere{{ j.ordre}}.png"/>
                                <p>{{ j.nom }}</p>
                                <p>Cartes: {{ j.nbCartes}}</p>
                                <p>MAIN</p>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="row" id="zone-mes-cartes">
                <div class="col-sm-12">
                    <h2>Mes cartes</h2>
                    <table class="table">
                        <tr>
                            <td style="text-align: center;" ng-repeat="carte in dtoPartie.mesCartes">
                                <img class="img-thumbnail" src="{{ pathImages}}/{{ carte.type}}.png"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    {% endraw %}
{% endblock %}

{% block javascripts %}
    <script src="{{ asset("js/angular.min.js") }}" type="text/javascript"></script>
    <script type="text/javascript">
                                    var app = angular.module("monApp", []);

                                    app.controller("monControleur", ["$scope", "$interval", "$http", function ($scope, $interval, $http) {

                                            $scope.dtoPartie = null;
                                            $scope.pathImages = "{{ asset("images") }}";
                                            
                                            $scope.classeJoueur = function(ordreJoueur){
                                                console.log("=>" + $scope.dtoPartie.partie.ordre);
                                                if( parseInt(ordreJoueur)===parseInt($scope.dtoPartie.partie.ordre))
                                                    return "{'background-color': 'red'}";
                                                
                                                return "";
                                            }
                                            
                                            $interval(function () {

                                                $http({
                                                    method: "GET",
                                                    url: "{{ path("ajax_etat_partie") }}"
                                                }).then(function (response) {

                                                    $scope.dtoPartie = response.data;
                                                });
                                            }, 5000);
                                        }]);
    </script>
{% endblock %}
